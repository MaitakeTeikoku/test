<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <title>Accelerometer and Orientation</title>
    <style>
        #acceleration {
            font-size: 20px;
        }

        #orientation {
            font-size: 20px;
        }

        #sensorRequest {
            z-index: 1;
            width: 100%;
            background-color: rgb(250, 250, 250);
        }
    </style>
</head>

<body>
    <h1>Accelerometer and Orientation</h1>

    <button id="sensorRequest" onclick="ClickRequestDeviceSensor();">センサーの有効化</button>

    <p id="acceleration">Acceleration: <span id="acceleration-values"></span></p>
    <p id="orientation">Orientation: <span id="orientation-values"></span></p>

    <script>
        function ClickRequestDeviceSensor() {
            //. ユーザーに「許可」を求めるダイアログを表示
            DeviceOrientationEvent.requestPermission()
                .then(function (response) {
                    if (response === 'granted') {
                        //. 許可された場合のみイベントハンドラを追加できる
                        window.addEventListener("deviceorientation", deviceOrientation);
                        window.addEventListener('devicemotion', handleMotion);
                        //. 画面上部のボタンを消す
                        document.getElementById("sensorRequest").style.display = "none";
                    }
                }).catch(function (e) {
                    console.log(e);
                });
        }

        //. DeviceOrientationEvent オブジェクトが有効な環境か？　をチェック
        if (window.DeviceOrientationEvent) {
            //. iOS13 以上であれば DeviceOrientationEvent.requestPermission 関数が定義されているので、ここで条件分岐
            if (DeviceOrientationEvent.requestPermission && typeof DeviceOrientationEvent.requestPermission === 'function') {
                //. iOS 13 以上の場合、
                //. 画面上部に「センサーの有効化」ボタンを表示
                document.getElementById("sensorRequest").style.display = "block";
            } else {
                //. Android または iOS 13 未満の場合、
                //. DeviceOrientationEvent オブジェクトが有効な場合のみ、deviceorientation イベント発生時に deviceOrientaion 関数がハンドリングするよう登録
                window.addEventListener("deviceorientation", deviceOrientation);
                window.addEventListener('devicemotion', handleMotion);
            }
        }

        //. deviceorientation イベントハンドラ
        function deviceOrientation(e) {
            //. 通常の処理を無効にする
            e.preventDefault();

            // 傾きの情報を取得
            var alpha = event.alpha;
            var beta = event.beta;
            var gamma = event.gamma;

            // 傾きの値を表示
            document.getElementById('orientation-values').textContent = 'alpha: ' + alpha + ', beta: ' + beta + ', gamma: ' + gamma;
        }

        // DeviceMotionイベントのハンドラー
        function handleMotion(event) {
            // 加速度の情報を取得
            var acceleration = event.acceleration;

            // 加速度の値を表示
            document.getElementById('acceleration-values').textContent = 'x: ' + acceleration.x + ', y: ' + acceleration.y + ', z: ' + acceleration.z;
        }

    </script>
</body>

</html>