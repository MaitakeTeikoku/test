<!DOCTYPE html>
<html>

<head>
    <title>test</title>

    <style>

    </style>
</head>

<body>
    <button id="requestDeviceSensor" onclick="clickRequestDeviceSensor();">センサーの有効化</button>
    <button id="isMathFloor" onclick="clickIsMathFloor();">小数点を切り捨てない</button>
    <div id="info"></div>

    <h2>ジャイロ</h2>
    <div>
        α: <span id="orientationA"></span>
    </div>
    <div>
        β: <span id="orientationB"></span>
    </div>
    <div>
        γ: <span id="orientationC"></span>
    </div>

    <h2>加速度</h2>
    <div>
        x: <span id="accelerationX"></span>
    </div>
    <div>
        y: <span id="accelerationY"></span>
    </div>
    <div>
        z: <span id="accelerationZ"></span>
    </div>



    <script>
        var isMathFloor = true;

        //. DeviceOrientationEvent オブジェクトが有効な環境か？　をチェック
        if (window.DeviceOrientationEvent) {
            //. iOS13 以上であれば DeviceOrientationEvent.requestPermission 関数が定義されているので、ここで条件分岐
            if (DeviceOrientationEvent.requestPermission && typeof DeviceOrientationEvent.requestPermission === 'function') {
                //. iOS 13 以上の場合、
                //. 画面上部に「センサーの有効化」ボタンを表示
                document.getElementById("requestDeviceSensor").style.display = "block";
            } else {
                //. Android または iOS 13 未満の場合、
                //. DeviceOrientationEvent オブジェクトが有効な場合のみ、deviceorientation イベント発生時に deviceOrientaion 関数がハンドリングするよう登録
                window.addEventListener("deviceorientation", deviceOrientation);
                window.addEventListener('devicemotion', deviceMotion);
            }
        }



        function clickRequestDeviceSensor() {
            //. ユーザーに「許可」を求めるダイアログを表示
            DeviceOrientationEvent.requestPermission()
                .then(function (response) {
                    if (response === 'granted') {
                        //. 許可された場合のみイベントハンドラを追加できる
                        window.addEventListener("deviceorientation", deviceOrientation);
                        window.addEventListener('devicemotion', deviceMotion);
                        //. 画面上部のボタンを消す
                        document.getElementById("requestDeviceSensor").disabled = "disabled";

                        document.getElementById('info').textContent = e;
                    }
                }).catch(function (e) {
                    document.getElementById('info').textContent = e;
                });
        }

        //. deviceorientation イベントハンドラ
        function deviceOrientation(event) {
            //. 通常の処理を無効にする
            event.preventDefault();

            // 傾きの情報を取得
            const alpha = event.alpha;
            const beta = event.beta;
            const gamma = event.gamma;

            if (isMathFloor) {
                // 傾きの値を表示
                document.getElementById('orientationA').textContent = Math.floor(alpha);
                document.getElementById('orientationB').textContent = Math.floor(beta);
                document.getElementById('orientationC').textContent = Math.floor(gamma);
            } else {
                // 傾きの値を表示
                document.getElementById('orientationA').textContent = alpha;
                document.getElementById('orientationB').textContent = beta;
                document.getElementById('orientationC').textContent = gamma;
            }

        }

        // deviceMotionイベントのハンドラ
        function deviceMotion(event) {
            // 加速度の情報を取得
            const acceleration = event.acceleration;

            const x = acceleration.x;
            const y = acceleration.y;
            const z = acceleration.z;

            if (isMathFloor) {
                // 加速度の値を表示
                document.getElementById('accelerationX').textContent = Math.floor(x);
                document.getElementById('accelerationY').textContent = Math.floor(y);
                document.getElementById('accelerationZ').textContent = Math.floor(z);
            } else {
                // 加速度の値を表示
                document.getElementById('accelerationX').textContent = x;
                document.getElementById('accelerationY').textContent = y;
                document.getElementById('accelerationZ').textContent = z;
            }
        }

        function clickIsMathFloor() {
            if (isMathFloor) {
                document.getElementById('isMathFloor').textContent = "小数点を切り捨て";
                isMathFloor = false;
            } else {
                document.getElementById('isMathFloor').textContent = "小数点を切り捨てない";
                isMathFloor = true;
            }
        }

    </script>
</body>

</html>